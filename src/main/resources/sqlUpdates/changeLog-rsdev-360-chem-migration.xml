<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
         http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.0.xsd">

    <changeSet id="21-02-2025" author="matthias" context="run">
        <preConditions onFail="CONTINUE" onError="MARK_RAN">
            <sqlCheck expectedResult="1">select if(count(id) > 0,1,0) from RSChemElement where smilesString is null and chemElementsFormat = 'MRV'</sqlCheck>
        </preConditions>
        <comment>RSDEV-360: fill RSChemElement table with smiles representation of chemical elements stored in jchem tables</comment>

        <sql>UPDATE RSChemElement rsc INNER JOIN jchem_structures jcs ON rsc.chemId = jcs.cd_id SET smilesString = jcs.cd_smiles where rsc.smilesString is null</sql>
        <sql>UPDATE RSChemElement rsc INNER JOIN jchem_reactions jcr ON rsc.reactionId = jcr.cd_id SET smilesString = jcr.cd_smiles where rsc.smilesString is null</sql>
        <sql>UPDATE RSChemElement rsc INNER JOIN jchem_rgroups jcg ON rsc.rgroupId = jcg.cd_id SET smilesString = jcg.cd_smiles where rsc.smilesString is null</sql>
    </changeSet>

    <changeSet id="26-03-2025" author="matthias" context="run">
        <preConditions onFail="MARK_RAN">
            <tableExists tableName="jchem_structures"/>
        </preConditions>
        <comment>RSDEV-573: move jchem/chemaxon tables</comment>

        <renameTable newTableName="bk_jchem_structures" oldTableName="jchem_structures" />
        <renameTable newTableName="bk_jchem_structures_UL" oldTableName="jchem_structures_UL" />
        <renameTable newTableName="bk_JChemProperties" oldTableName="JChemProperties" />
        <renameTable newTableName="bk_JChemProperties_CR" oldTableName="JChemProperties_CR" />
        <renameTable newTableName="bk_jchem_reactions" oldTableName="jchem_reactions" />
        <renameTable newTableName="bk_jchem_reactions_UL" oldTableName="jchem_reactions_UL" />
        <renameTable newTableName="bk_jchem_rgroups" oldTableName="jchem_rgroups" />
        <renameTable newTableName="bk_jchem_rgroups_UL" oldTableName="jchem_rgroups_UL" />
    </changeSet>

</databaseChangeLog>

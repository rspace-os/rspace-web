tinymce.PluginManager.add("pyrat", function (editor, url) {
  editor.addCommand("cmdPyrat", function () {
    editor.windowManager.openUrl({
      title: "Insert from PyRAT",
      url: url + "/dialog.html",
      width: 1400,
      height: 800,
      buttons: [
        {
          type: "cancel",
          text: "Cancel"
        },
        {
          type: "custom",
          name: "insert",
          text: "Insert",
          primary: true
        }
      ],
      onAction(dialogApi, button) {
        if (button.name == "insert") {
          editor.fire("pyrat-insert");
        }
      },
      onClose() {
        RS.showHelpButton();
      },
      onMessage(dialogApi, details) {
        let button = $("button[title='Insert']");
        if (details.mceAction == "disable") {
          button.attr("disabled", "disabled");
        } else if (details.mceAction == "enable") {
          button.prop("disabled", null);
          button.removeAttr("disabled");
        }
      }
    });
  });

  // Add a button that opens a window
  editor.ui.registry.addButton("pyrat", {
    tooltip: "Link to PyRAT",
    icon: "pyrat",
    onAction: function () {
      editor.execCommand("cmdPyrat");
      RS.hideHelpButton();
    }
  });

  // Adds a menu item to the insert menu
  editor.ui.registry.addMenuItem("optPyrat", {
    text: "From PyRAT",
    icon: "pyrat",
    onAction: function () {
      editor.execCommand("cmdPyrat");
      RS.hideHelpButton();
    },
  });

  if(!window.insertActions) window.insertActions = new Map();
  window.insertActions.set("optPyrat", {
    text: 'From PyRAT',
    icon: 'pyrat',
    action: () => {
      editor.execCommand("cmdPyrat");
    },
  });

});

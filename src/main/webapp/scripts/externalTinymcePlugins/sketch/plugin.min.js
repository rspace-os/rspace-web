/**
 * Sketch plugin
 * Author: fran
 * Date : 23/09/2015
 */

(function () {
	'use strict';

	var global = tinymce.util.Tools.resolve('tinymce.PluginManager');

	var register = function (editor, url) {
		var header_height = 35;
		var footer_height = 50;

		editor.addCommand('cmdSketch', function () {
			editor.windowManager.openUrl({
				title: 'Sketch',
				id: 'sketchIframe',
				url: url + '/iframe.html',
				width: window.innerWidth,
				height: window.innerHeight - header_height - footer_height,
				buttons: [
					{
						text: 'Cancel',
						type: 'custom',
						name: 'cancel',
					},
					{
						text: 'Insert',
						type: 'custom',
						name: 'insert',
						primary: true
					}
				],
				onAction(api, button) {
					if(button.name == 'cancel') {
						editor.execCommand("cmdConfirmCancel");
					} else if(button.name == 'insert') {
						editor.fire('sketch-insert');
					}
				},
				onClose: function (event) {
				},
			});
			$('.tox-dialog').css('height', '100vh').css('max-height', '');
		});
	};
	var Commands = { register: register };

	var register$1 = function (editor) {
		editor.ui.registry.addButton('sketch', {
			tooltip: 'Insert sketch',
			icon: 'sketch',
			onAction: function () { 
				return editor.execCommand("cmdSketch"); 
			}
		});

		editor.ui.registry.addMenuItem('optSketch', {
			text: 'Sketch',
			icon: 'sketch',
			onAction: function () { 
				return editor.execCommand("cmdSketch"); 
			}
		});

    if(!window.insertActions) window.insertActions = new Map();
    window.insertActions.set("optSketch", {
      text: 'Sketch',
      icon: 'sketch',
      action: () => {
        editor.execCommand('cmdSketch');
      },
    });
	};
	var Buttons = { register: register$1 };

	function Plugin () {
		global.add('sketch', function (editor, url) {
			Commands.register(editor, url);
			Buttons.register(editor);
		});
	}

	Plugin();
}());
